<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapitre 10 : Allocation Dynamique - Learn2succeed</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/main.css">
    <link rel="stylesheet" href="../../../css/components.css">
    <link rel="stylesheet" href="../../../css/courses.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <style>
        .solution-box {
            display: none;
            margin-top: 1rem;
            padding: 1.5rem;
            background-color: #f8f9fa;
            border-left: 4px solid #0d6efd;
            border-radius: 4px;
        }
    </style>
</head>

<body>
    <header class="site-header">
        <div class="container">
            <a href="../../../index.html" class="site-logo"><span>üìö</span><span>Learn2succeed</span></a>
            <nav class="main-nav">
                <a href="../../../index.html">Accueil</a>
                <a href="../../../dashboard.html">Tableau de bord</a>
            </nav>
        </div>
    </header>

    <main id="main-content">
        <div class="container-fluid">
            <div class="row">
                <!-- Sidebar -->
                <aside class="col-lg-3 d-none d-lg-block" style="padding: var(--spacing-md);">
                    <div class="course-sidebar">
                        <h3>Langage C</h3>
                        <ul class="chapter-list">
                            <li><a href="ch01-introduction.html">1. Introduction</a></li>
                            <li><a href="ch02-variables.html">2. Variables</a></li>
                            <li><a href="ch03-operateurs.html">3. Op√©rateurs</a></li>
                            <li><a href="ch04-conditions.html">4. Conditions</a></li>
                            <li><a href="ch05-boucles.html">5. Boucles</a></li>
                            <li><a href="ch06-fonctions.html">6. Fonctions</a></li>
                            <li><a href="ch07-pointeurs-bases.html">7. Pointeurs (Bases)</a></li>
                            <li><a href="ch08-tableaux.html">8. Tableaux</a></li>
                            <li><a href="ch09-chaines.html">9. Cha√Ænes</a></li>
                            <li><a href="ch10-allocation.html" class="active">10. All. Dynamique</a></li>
                            <li><a href="ch11-structs.html">11. Structures</a></li>
                            <li><a href="ch12-pointeurs-avances.html">12. Ptr Avanc√©s</a></li>
                            <li><a href="ch13-fichiers.html">13. Fichiers</a></li>
                            <li><a href="ch14-preprocesseur.html">14. Module/Header</a></li>
                            <li><a href="ch15-projet-final.html">15. Projet Final</a></li>
                        </ul>
                    </div>
                </aside>

                <article class="col-lg-9">
                    <div class="container-reading section-sm">
                        <nav aria-label="breadcrumb">
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item"><a href="index.html">Cours C</a></li>
                                <li class="breadcrumb-item active">Chapitre 10</li>
                            </ol>
                        </nav>

                        <h1 class="mb-4">Chapitre 10 : Allocation Dynamique</h1>

                        <!-- Section 1 -->
                        <section class="mb-5">
                            <h2>1. Pile (Stack) vs Tas (Heap)</h2>
                            <p>Jusqu'√† pr√©sent, vos variables √©taient sur la <strong>Pile (Stack)</strong>. La m√©moire
                                est g√©r√©e automatiquement mais la taille doit √™tre connue √† la compilation.</p>
                            <p>Pour g√©rer des donn√©es de taille inconnue ou variable (ex: un tableau qui grandit), on
                                utilise le <strong>Tas (Heap)</strong>. Vous devez g√©rer vous-m√™me l'allocation et la
                                lib√©ration.</p>
                        </section>

                        <!-- Section 2 -->
                        <section class="mb-5">
                            <h2>2. malloc et le header stdlib.h</h2>
                            <p><code>malloc(taille)</code> demande au syst√®me d'exploitation un bloc de m√©moire.</p>
                            <pre><code class="language-c">#include <stdlib.h>

int main() {
    // Je veux stocker un entier (4 octets)
    int *p = malloc(sizeof(int)); 
    if (p == NULL) {
        // √âchec de l'allocation (plus de RAM ?)
        exit(1);
    }
    
    *p = 10; // Utilisation
    // ...
}</code></pre>
                        </section>

                        <!-- Section 3 -->
                        <section class="mb-5">
                            <h2>3. free : Lib√©rez la m√©moire !</h2>
                            <p>En C, il n'y a pas de Garbage Collector. Si vous ne lib√©rez pas la m√©moire avec
                                <code>free(pointeur)</code>, elle reste occup√©e jusqu'√† la fin du programme. C'est une
                                <strong>fuite de m√©moire</strong>.
                            </p>
                            <pre><code class="language-c">free(p); // On rend la m√©moire
p = NULL; // Bonne pratique pour ne plus l'utiliser par erreur</code></pre>
                        </section>

                        <!-- QUIZ -->
                        <section class="my-5 p-4 border rounded bg-white shadow-sm">
                            <h3 class="mb-4">üß† Quiz de Validation (6 Questions)</h3>

                            <!-- Q1 -->
                            <div class="mb-4">
                                <p class="fw-bold">1. Dans quelle biblioth√®que se trouve `malloc` ?</p>
                                <div class="btn-group w-100">
                                    <button class="btn btn-outline-secondary"
                                        onclick="check(this, false)">&lt;stdio.h&gt;</button>
                                    <button class="btn btn-outline-secondary"
                                        onclick="check(this, true)">&lt;stdlib.h&gt;</button>
                                    <button class="btn btn-outline-secondary"
                                        onclick="check(this, false)">&lt;malloc.h&gt;</button>
                                </div>
                            </div>

                            <!-- Q2 -->
                            <div class="mb-4">
                                <p class="fw-bold">2. Que retourne `malloc` en cas d'√©chec ?</p>
                                <div class="btn-group w-100">
                                    <button class="btn btn-outline-secondary" onclick="check(this, false)">-1</button>
                                    <button class="btn btn-outline-secondary" onclick="check(this, false)">0</button>
                                    <button class="btn btn-outline-secondary" onclick="check(this, true)">NULL</button>
                                </div>
                            </div>

                            <!-- Q3 -->
                            <div class="mb-4">
                                <p class="fw-bold">3. Que se passe-t-il si on oublie `free` ?</p>
                                <div class="btn-group w-100">
                                    <button class="btn btn-outline-secondary" onclick="check(this, true)">Fuite de
                                        m√©moire (Memory Leak)</button>
                                    <button class="btn btn-outline-secondary" onclick="check(this, false)">Erreur de
                                        compilation</button>
                                    <button class="btn btn-outline-secondary" onclick="check(this, false)">Le programme
                                        plante imm√©diatement</button>
                                </div>
                            </div>

                            <!-- Q4 -->
                            <div class="mb-4">
                                <p class="fw-bold">4. Que fait `realloc` ?</p>
                                <div class="btn-group w-100">
                                    <button class="btn btn-outline-secondary" onclick="check(this, false)">Lib√®re la
                                        m√©moire</button>
                                    <button class="btn btn-outline-secondary" onclick="check(this, true)">Change la
                                        taille d'un bloc allou√©</button>
                                    <button class="btn btn-outline-secondary" onclick="check(this, false)">Copie la
                                        m√©moire ailleurs</button>
                                </div>
                            </div>

                            <!-- Q5 -->
                            <div class="mb-4">
                                <p class="fw-bold">5. La m√©moire allou√©e par `malloc` est-elle initialis√©e √† 0 ?</p>
                                <div class="btn-group w-100">
                                    <button class="btn btn-outline-secondary" onclick="check(this, false)">Oui,
                                        toujours</button>
                                    <button class="btn btn-outline-secondary" onclick="check(this, true)">Non, elle
                                        contient n'importe quoi (sauf avec calloc)</button>
                                </div>
                            </div>

                            <!-- Q6 -->
                            <div class="mb-4">
                                <p class="fw-bold">6. Peut-on utiliser `free` sur une variable statique (int x;) ?</p>
                                <div class="btn-group w-100">
                                    <button class="btn btn-outline-secondary" onclick="check(this, false)">Oui</button>
                                    <button class="btn btn-outline-secondary" onclick="check(this, true)">Non, cela fera
                                        planter le programme !</button>
                                </div>
                            </div>
                        </section>

                        <!-- EXERCISES -->
                        <section class="my-5">
                            <h3 class="mb-4 border-bottom pb-2">üíª Exercices Pratiques</h3>

                            <!-- Ex 1 -->
                            <div class="exercise-card mb-4">
                                <div class="card h-100 border-primary">
                                    <div class="card-header bg-primary text-white">Exercice 1 : Allocation Simple</div>
                                    <div class="card-body">
                                        <p>Allouez dynamiquement un <code>int</code>, mettez-y la valeur 2024,
                                            affichez-la, puis lib√©rez la m√©moire.</p>
                                        <button class="btn btn-outline-primary btn-sm"
                                            onclick="toggleSolution('sol1')">Voir Solution</button>
                                        <div id="sol1" class="solution-box">
                                            <pre><code class="language-c">#include <stdio.h>
#include <stdlib.h>

int main() {
    int *p = malloc(sizeof(int));
    if (p != NULL) {
        *p = 2024;
        printf("Valeur : %d\n", *p);
        free(p);
    }
    return 0;
}</code></pre>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Ex 2 -->
                            <div class="exercise-card mb-4">
                                <div class="card h-100">
                                    <div class="card-header bg-success text-white">Exercice 2 : Tableau Dynamique</div>
                                    <div class="card-body">
                                        <p>Allouez un tableau dynamique. Remplissez-le de z√©ros, affichez, puis lib√©rez.
                                        </p>
                                        <button class="btn btn-outline-success btn-sm"
                                            onclick="toggleSolution('sol2')">Voir Solution</button>
                                        <div id="sol2" class="solution-box">
                                            <pre><code class="language-c">#include <stdio.h>
#include <stdlib.h>

int main() {
    int taille = 5; 
    int *tab = malloc(taille * sizeof(int));
    if (tab == NULL) return 1;

    for(int i=0; i<taille; i++) {
        tab[i] = 0;
        printf("%d ", tab[i]);
    }
    free(tab);
    return 0;
}</code></pre>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Ex 3 -->
                            <div class="exercise-card mb-4">
                                <div class="card h-100">
                                    <div class="card-header bg-info text-dark">Exercice 3 : calloc vs malloc</div>
                                    <div class="card-body">
                                        <p>Utilisez <code>calloc</code> pour allouer un tableau de 10 entiers √† z√©ro.
                                        </p>
                                        <button class="btn btn-outline-info btn-sm"
                                            onclick="toggleSolution('sol3')">Voir Solution</button>
                                        <div id="sol3" class="solution-box">
                                            <pre><code class="language-c">#include <stdio.h>
#include <stdlib.h>

int main() {
    int *tab = calloc(10, sizeof(int));
    printf("Premier element : %d (Devrait etre 0)\n", tab[0]);
    free(tab);
    return 0;
}</code></pre>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Ex 4 -->
                            <div class="exercise-card mb-4">
                                <div class="card h-100">
                                    <div class="card-header bg-warning text-dark">Exercice 4 : Redimensionner (realloc)
                                    </div>
                                    <div class="card-body">
                                        <p>Agrandissez un tableau avec <code>realloc</code>.</p>
                                        <button class="btn btn-outline-warning btn-sm"
                                            onclick="toggleSolution('sol4')">Voir Solution</button>
                                        <div id="sol4" class="solution-box">
                                            <pre><code class="language-c">#include <stdio.h>
#include <stdlib.h>

int main() {
    int *tab = malloc(2 * sizeof(int));
    tab[0] = 1; tab[1] = 2;

    int *temp = realloc(tab, 5 * sizeof(int));
    if (temp != NULL) {
        tab = temp;
        tab[2] = 3; 
    }
    
    free(tab);
    return 0;
}</code></pre>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Ex 5 -->
                            <div class="exercise-card mb-4">
                                <div class="card h-100 border-danger">
                                    <div class="card-header bg-danger text-white">Exercice 5 : La Cha√Æne Dynamique</div>
                                    <div class="card-body">
                                        <p>Impl√©mentez <code>strdup</code> : copie d'une cha√Æne avec malloc.</p>
                                        <button class="btn btn-outline-danger btn-sm"
                                            onclick="toggleSolution('sol5')">Voir Solution</button>
                                        <div id="sol5" class="solution-box">
                                            <pre><code class="language-c">#include <stdio.h>
#include <stdlib.h>
#include <string.h>

char* maCopie(const char* src) {
    int len = strlen(src);
    char *dest = malloc(len + 1); // +1 pour le \0
    if (dest) strcpy(dest, src);
    return dest;
}

int main() {
    char *s = maCopie("Hello Heap !");
    printf("%s\n", s);
    free(s);
    return 0;
}</code></pre>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </section>

                        <div class="text-center my-5">
                            <a href="ch09-chaines.html" class="btn btn-outline-secondary btn-lg me-2">‚Üê Pr√©c√©dent</a>
                            <a href="ch11-structs.html" class="btn btn-success btn-lg">Chapitre 11 ‚Üí</a>
                        </div>
                    </div>
                </article>
            </div>
        </div>
    </main>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-c.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Injection Scripts UI Globaux -->
    <script src="../../../js/course-controls.js"></script>

    <script>
        function check(btn, isCorrect) {
            const group = btn.parentElement;
            // Nettoyage des classes pr√©c√©dentes
            Array.from(group.children).forEach(b => {
                b.classList.remove('btn-success', 'btn-danger');
                b.classList.add('btn-outline-secondary');
            });
            // Application du r√©sultat
            if (isCorrect) {
                btn.classList.add('btn-success');
                btn.classList.remove('btn-outline-secondary');
            } else {
                btn.classList.add('btn-danger');
                btn.classList.remove('btn-outline-secondary');
            }
        }

        function toggleSolution(id) {
            const el = document.getElementById(id);
            el.style.display = (el.style.display === 'block') ? 'none' : 'block';
        }
    </script>
</body>

</html>